<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE document PUBLIC
  "-//Apache Software Foundation//DTD XDOC 1.0//EN"
  "http://maven.apache.org/dtd/xdoc_1_0.dtd">
<!--
    Copyright 2015-2019 Hippo

    Licensed under the Apache License, Version 2.0 (the  "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS"
    BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
-->
<document>
  <properties>
    <title>Installing BloomReach XM Extra Folder Context Menus</title>
  </properties>
  <body>

    <section name="Installing BloomReach XM Extra Folder Context Menus Plugin">
      <subsection name="Add Dependencies">
        <p>
          Make sure you have the forge Maven2 repository reference and dependency definition in the root pom.xml of your project.
        </p>
        <div class="brush: xml">
          <source><![CDATA[
    <repositories>

      <!-- SNIP -->

      <repository>
        <id>hippo-maven2-forge</id>
        <name>Hippo Maven 2 Forge repository</name>
        <url>http://maven.onehippo.com/maven2-forge/</url>
        <snapshots />
      </repository>

      <!-- SNIP -->

    </repositories>

    <!-- SNIP -->

    <dependencyManagement>

      <!-- SNIP -->

      <dependencies>

        <!-- SNIP -->

        <!-- NOTE: You should set a property named 'forge.folderctxmenus.version' to a version of this plugin! -->

        <dependency>
          <groupId>org.onehippo.forge.folderctxmenus</groupId>
          <artifactId>folderctxmenus-repository</artifactId>
          <version>${forge.folderctxmenus.version}</version>
        </dependency>

        <dependency>
          <groupId>org.onehippo.forge.folderctxmenus</groupId>
          <artifactId>folderctxmenus-frontend</artifactId>
          <version>${forge.folderctxmenus.version}</version>
        </dependency>

        <!-- SNIP -->

      </dependencies>

      <!-- SNIP -->

    </dependencyManagement>
    ]]></source>
        </div>
        <p>
          Add the following dependencies to either <code>cms-dependencies/pom.xml</code> in BloomReach XM v13
          or <code>cms/pom.xml</code> in the earlier versions.
        </p>
        <div class="brush: xml">
          <source><![CDATA[
    <dependencies>

      <!-- SNIP -->

      <dependency>
        <groupId>org.onehippo.forge.folderctxmenus</groupId>
        <artifactId>folderctxmenus-repository</artifactId>
      </dependency>

      <dependency>
        <groupId>org.onehippo.forge.folderctxmenus</groupId>
        <artifactId>folderctxmenus-frontend</artifactId>
      </dependency>

      <!-- SNIP -->

    </dependencies>
    ]]></source>
        </div>
        <p>
          Now, you're ready to use the plugin!
        </p>
      </subsection>
    </section>

    <section name="Installing Only the Common module of BloomReach XM Extra Folder Context Menus Plugin">
      <subsection name="Add Dependencies">
        <p>
          If you want to use only <a href="index.html#Programmatic_Folder_Copy_and_Move">Programmatic Folder Copy and Move</a>,
          then you may add the following dependency only.
        </p>
        <div class="brush: xml">
          <source><![CDATA[
    <repositories>

      <!-- SNIP -->

      <repository>
        <id>hippo-maven2-forge</id>
        <name>Hippo Maven 2 Forge repository</name>
        <url>http://maven.onehippo.com/maven2-forge/</url>
        <snapshots />
      </repository>

      <!-- SNIP -->

    </repositories>

    <!-- SNIP -->

    <dependencyManagement>

      <!-- SNIP -->

      <dependencies>

        <!-- SNIP -->

        <!-- NOTE: You should set a property named 'forge.folderctxmenus.version' to a version of this plugin! -->

        <dependency>
          <groupId>org.onehippo.forge.folderctxmenus</groupId>
          <artifactId>folderctxmenus-common</artifactId>
          <version>${forge.folderctxmenus.version}</version>
        </dependency>

        <!-- SNIP -->

      </dependencies>

      <!-- SNIP -->

    </dependencyManagement>
    ]]></source>
        </div>
        <p>
          And add the following dependency reference into your Web Application module subproject(s).
        </p>
        <div class="brush: xml">
          <source><![CDATA[
    <dependencies>

      <!-- SNIP -->

      <dependency>
        <groupId>org.onehippo.forge.folderctxmenus</groupId>
        <artifactId>folderctxmenus-common</artifactId>
      </dependency>

      <!-- SNIP -->

    </dependencies>
    ]]></source>
        </div>
        <p>
          Now, you're ready to use the common module of the plugin!
        </p>
      </subsection>
    </section>


    <section name="Installing BloomReach XM Extra Folder Context Menus Plugin">
      <subsection name="Permissions / privilege for extra folder options">
        <p>
          For users to have access to the extra folder options, it is required that they are granted an additional
          role folderctxmenus-extra (privilege 'folderctxmenus:extra') on the folders they should have those extra actions on.
        </p>

        <p>
          By default only the admin has privileges to use the extra folder options (for all content), through
          security domain 'extra-folder-options'. By default, all users that have the xm.content.admin user role will
          have the extra options on all content folders.
        </p>

        <p>
          To allow editors to have the copy and move options on folders, a domain rules needs to be added which
          provides the 'folderctxmenus-extra' privilege to the required set of folders . The following example will
          provide those options on everything below the folderctxmenusdemo folders (within the content folders for
          documents, gallery and assets).
        </p>
        <div class="brush: yaml">
          <source><![CDATA[
definitions:
  config:
    /hippo:configuration/hippo:domains/extra-folder-options:
      jcr:primaryType: hipposys:domain
      /content-document-domain:
        jcr:primaryType: hipposys:domainrule
        /content-and-descendants:
          jcr:primaryType: hipposys:facetrule
          hipposys:equals: true
          hipposys:facet: jcr:path
          hipposys:type: Reference
          hipposys:value: /content/documents/folderctxmenusdemo
      /content-gallery-domain:
        jcr:primaryType: hipposys:domainrule
        /content-and-descendants:
          jcr:primaryType: hipposys:facetrule
          hipposys:equals: true
          hipposys:facet: jcr:path
          hipposys:type: Reference
          hipposys:value: /content/gallery/folderctxmenusdemo
      /content-assets-domain:
        jcr:primaryType: hipposys:domainrule
        /content-and-descendants:
          jcr:primaryType: hipposys:facetrule
          hipposys:equals: true
          hipposys:facet: jcr:path
          hipposys:type: Reference
          hipposys:value: /content/assets/folderctxmenusdemo
      /editor:
        jcr:primaryType: hipposys:authrole
        hipposys:groups:
          .meta:category: system
          .meta:add-new-system-values: true
          type: string
          value: []
        hipposys:role: folderctxmenus-extra
        hipposys:userrole: xm.content.editor
        hipposys:users:
          .meta:category: system
          .meta:add-new-system-values: true
          type: string
          value: []
        ]]></source>
        </div>
      </subsection>
    </section>


  </body>
</document>
